<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>
		Order Details
	</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="/homeStyle.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
		crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
		integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="/shop.css">
	<link rel="stylesheet" href="/cartStyle.css" />
	<link href="/main2.css" rel="stylesheet" type="text/css" />
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.css">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.min.js"></script>
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>

<body>

	<!-- header section starts -->

	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<div class="container-fluid">
			<div class="brand-container me-3">
				<a class="navbar-brand" href="#"
					style="font-size: 30px;font-weight: 600;font-family: 'Kanit', sans-serif;">Fashion Feet</a>
			</div>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse"
				data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse align-items-center justify-content-end" id="navbarSupportedContent">
				<div class="category-container pe-4">
					<ul class="navbar-nav mb-2 mb-lg-0 text-center">
						<li class="nav-item">
							<a class="nav-link me-lg-1" aria-current="page" href="/home">Home</a>
						</li>
						<li class="nav-item ">
							<a class="nav-link  me-lg-1" href="/shop" id="navbarDropdown" role="button">Shop</a>
						</li>
						<li class="nav-item">
							<a class="nav-link  me-lg-1" href="/contact" id="navbarDropdown" role="button">Contact
								Us</a>
						</li>
					</ul>
				</div>
				<div class="right-container d-lg-flex align-items-center">
					<form class="d-flex">
						<input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search"
							name="search">
						<button type="submit" class="ms-1 bg-light"
							style="border: 1px solid rgb(227, 227, 227); border-radius: 5px;padding: 5px;"
							value="search"><i class="fa-solid fa-magnifying-glass"></i></button>
					</form>
					<div class="user-head pe-4 mt-2 mt-lg-0 mt-md-0 mt-sm-0">
						<a href="" style="text-decoration: none; color: rgb(98, 98, 98); font-size: 25px;"
							class="me-2 ms-2"><i class="head-btn fa-regular fa-heart"></i></a>
						<a href="/addtocart" style="text-decoration: none; color: rgb(98, 98, 98); font-size: 25px;"
							class="me-2"><i class="head-btn fa-solid fa-cart-shopping"></i></a>
						<a href="/my-profile" style="text-decoration: none; color: rgb(0, 0, 0); font-size: 25px;"><i
								class="head-btn fa-solid fa-user"></i></a>
					</div>
				</div>
			</div>
		</div>
	</nav>


	<!-- header section ended -->


	<!-- content section starts -->

	<div class="container btn-container d-flex justify-content-end align-items-center">
		<a href="/my-profile" class="btn btn-primary">Back</a>
	</div>
	<section class="content-main">
		<div class="user-table-container container">
			<% if (!order || order.length===0){ %>
				<div class="container d-flex justify-content-center align-items-center">
					<div class="inner-container">
						<p>No Orders Yet</p>
						<a href="/shop" class="btn btn-outline-success rounded">Start Shopping</a>
					</div>
				</div>
				<% } else { %>
					<div class="card-header py-3">
						<h5 class="mb-0">Order Details</h5>
					</div>
					<div class="row">
						<div class="col-lg-12">
							<div class="tables-responsive">
								<table class="table">
									<thead>
										<tr>
											<th width="30%">Product</th>
											<th width="30%">Price</th>
											<th width="20%">Status</th>
											<th width="20%">Actions</th>
										</tr>
									</thead>
									<tbody>
										<% order.reverse() %>
											<% order.forEach(function(order) {%>
												<% for(let i=0;i<order.orders.length;i++) { %>
													<tr>
														<a href="">
															<td>
																<a class="itemside" href="#">
																	<div class="left">
																		<img src="/admin-assets/uploads/<%=order.orders[i].product_image%>"
																			width="40" height="40" class="img-xs"
																			alt="Item">
																	</div>
																	<div class="info">
																		<%=order.orders[i].product_name%>
																	</div>
																</a>
															</td>
															<td class="item-details">
																â‚¹<%=order.orders[i].product_price%>(Qty : <%=
																		order.orders[i].product_qauntity%>)
															</td>
															<td class="item-details">
																<%=order.delivery_status%>
															</td>
															<td>
																<a href="/view-order?orderId=<%=order._id%>&addressId=<%=order.order_Address%>"
																	class="btn btn-sm btn-primary mb-1 mb-lg-0 mb-md-0">View</a>
															<% if(order.delivery_status==="Returned" || order.delivery_status==="Cancelled") {%>
																	<a href="/shop"
																		class="btn btn-sm btn-success mb-1 mb-lg-0 mb-md-0">Buy</a>
																<%} else if(order.delivery_status==="Delivered"){%>
																		<button
																			class="btn btn-sm btn-danger mb-1 mb-lg-0 mb-md-0"
																			onclick="returnOrder('<%=order._id%>')">return</button>
																<%} else {%>
																	<button
																			class="btn btn-sm btn-danger mb-1 mb-lg-0 mb-md-0"
																			onclick="cancelOrder('<%=order._id%>')">cancel</button>
																</td>
																<%}%>
													</tr>
													<%}%>
													<% }) %>
									</tbody>
								</table>
							</div>
						</div>
					</div>
		</div>
		<div class="container">
			<% if (totalpages > 1) { %>
				<div class="pagination-area">
					<nav aria-label="Page navigation example">
						<ul class="pagination justify-content-start">
							<% if (currentpage > 1) { %>
							<li class="page-item active"><a class="page-link" href="/load-Orders?page=<%= currentpage - 1 %>">Previous</a></li>
							<% } %>
							<% for (let i = 1; i <= totalpages; i++) { %>
							<li class="page-item"><a class="page-link" href="/load-Orders?page=<%= i %>"><%= i %></a></li>
							<% } %>
							<% if (currentpage < totalpages) { %>
							<li class="page-item active"><a class="page-link" href="/load-Orders?page=<%= currentpage + 1 %>">Next</a></li>
							<% } %>
						</ul>
					</nav>
				</div>
			   <% }%>
			   <% } %>
		</div>
	</section>

	<!-- content section ends -->

	<!-- Modal -->
	<div class="modal fade" id="itemModal" tabindex="-1" aria-labelledby="itemModalLabel" aria-hidden="true"
		data-bs-target="#staticBackdrop">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="itemModalLabel">Order Details</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body d-flex">
					<!-- Add your item details here -->
					<img src="" alt="Item Image" class="img-fluid" id="itemImage" width="100" height="100"
						class="img-fluid">
					<div class="texts ms-3">
						<p id="itemName" style="color: black;"></p>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<!-- JavaScript code to open the modal with the item details -->
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
	<script>

function cancelOrder(orderid) {
      Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, cancel it!'
      }).then((result) => {
        if (result.isConfirmed) {
          $.ajax({
            url: '/cancel-order?orderid=' + orderid,
            method: 'patch',
            success: (response) => {
              if (response.status === true) {
                Toastify({
                  text: "Order Cancelled Successfully",
                  className: "info",
                  style: {
                    background: "linear-gradient(to right, #00b09b, #96c93d)",
                  }
                }).showToast()
                setTimeout(() => {
                  location.href = "/load-Orders"
                }, 1000);
              }
            }
          });
        }
      });
    }

		function returnOrder(orderid) {
			Swal.fire({
				title: 'Are you sure?',
				text: "You won't be able to revert this!",
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				confirmButtonText: 'Yes, return it!'
			}).then((result) => {
				if (result.isConfirmed) {
					$.ajax({
						url: '/return-order?orderid=' + orderid,
						method: 'patch',
						success: (response) => {
							if (response.status === true) {
								Toastify({
									text: "Order Returned",
									className: "info",
									style: {
										background: "linear-gradient(to right, #00b09b, #96c93d)",
									},
								}).showToast();

								setTimeout(() => {
									window.location.href = '/load-Orders';  // Redirect after toast is shown
								}, 2000);
							}

						}
					});
				}
			});
		}

		document.addEventListener('DOMContentLoaded', function () {
			const itemLinks = document.querySelectorAll('.itemside');

			itemLinks.forEach(link => {
				link.addEventListener('click', function (event) {
					event.preventDefault();

					const itemName = this.querySelector('.info').textContent;
					const itemImageSrc = this.querySelector('img').src;

					// Update the modal content with the item details
					document.getElementById('itemName').textContent = itemName;
					document.getElementById('itemImage').src = itemImageSrc;

					// Show the modal
					const itemModal = new bootstrap.Modal(document.getElementById('itemModal'));
					itemModal.show();
				});
			});
		});
	</script>

</body>

</html>